<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ç”Ÿé•·è©•ä¼°å°å¹«æ‰‹ | ä¸‹ç­å¾Œçš„æŸå®…ç¾Š</title>
<style>
  :root {
    --primary: #007AFF; --primary-light: #E3F2FD;
    --secondary: #34C759; --accent: #FF9500;
    --text: #1C1C1E; --gray: #8E8E93;
    --bg: #F2F2F7; --card: #FFFFFF;
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 50px; }

  /* Header */
  .header { background: var(--card); padding: 15px; text-align: center; border-bottom: 1px solid #E5E5EA; position: sticky; top: 0; z-index: 100; }
  .header a { text-decoration: none; color: var(--text); font-weight: 800; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; gap: 8px; }
  .fb-tag { background: #1877F2; color: #fff; font-size: 0.7rem; padding: 3px 6px; border-radius: 4px; font-weight: 600; }

  /* Nav Tabs */
  .nav-wrapper { background: var(--bg); position: sticky; top: 54px; z-index: 99; padding: 10px 0; display: flex; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
  .nav { display: flex; gap: 8px; overflow-x: auto; padding: 0 10px; max-width: 100%; -webkit-overflow-scrolling: touch; scrollbar-width: none;} 
  .nav::-webkit-scrollbar { display: none; }
  .nav-btn { flex: 0 0 auto; padding: 8px 16px; border-radius: 20px; border: 1px solid #D1D1D6; background: #fff; color: var(--gray); font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 0.9rem; }
  .nav-btn.active { background: var(--text); color: #fff; border-color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.15); }

  /* Container */
  .container { max-width: 600px; margin: 15px auto; padding: 0 15px; }
  .view { display: none; animation: fade 0.3s; }
  .view.active { display: block; }
  @keyframes fade { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }

  /* Card & Inputs */
  .card { background: var(--card); border-radius: 16px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); margin-bottom: 20px; }
  .label { font-size: 0.85rem; color: var(--gray); font-weight: 700; display: block; margin-bottom: 6px; text-transform: uppercase; }
  .row { display: flex; gap: 12px; margin-bottom: 15px; }
  input, select { width: 100%; padding: 12px; border: 1px solid #C7C7CC; border-radius: 10px; font-size: 1rem; background: #F9F9F9; text-align: center; }
  input:focus { outline: none; border-color: var(--primary); background: #fff; }

  /* Date Box */
  .date-box { background: #F2F2F7; padding: 12px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #E5E5EA; }
  .date-row { display: flex; align-items: center; gap: 5px; margin-top: 8px; }
  .sub-lbl { font-size: 0.9rem; color: #666; white-space: nowrap; font-weight: 600; margin-right: 5px;}

  /* Radio */
  .radio-grp { display: flex; gap: 10px; margin-bottom: 15px; }
  .radio-btn { flex: 1; padding: 12px; text-align: center; background: #F2F2F7; border-radius: 10px; cursor: pointer; font-weight: bold; color: var(--gray); border: 2px solid transparent; }
  .radio-btn.sel-boy { background: #E3F2FD; color: #007AFF; border-color: #007AFF; }
  .radio-btn.sel-girl { background: #FCE4EC; color: #FF2D55; border-color: #FF2D55; }

  /* Buttons */
  .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-top: 10px; transition: 0.1s; }
  .btn:active { transform: scale(0.98); }
  .btn-primary { background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(0,122,255,0.2); }
  .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); margin-top: 20px; }

  /* Visual Bar (Fixed Gradient) */
  .bar-box { margin-bottom: 25px; }
  .bar-container { 
      height: 12px; 
      /* Fixed: Gradient logic restored */
      background: linear-gradient(90deg, #FF9500 0%, #FFD60A 15%, #34C759 15%, #34C759 85%, #FFD60A 85%, #FF9500 100%);
      border-radius: 6px; 
      position: relative; 
      margin: 8px 0; 
  }
  .marker { 
      position: absolute; top: -3px; width: 4px; height: 18px; 
      background: #1C1C1E; border: 1px solid white;
      left: 50%; transition: left 0.5s; border-radius: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  .bar-legend { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--gray); margin-top: 5px; }
  .bar-legend span b { display: block; font-size: 0.7rem; color: #aaa; font-weight: normal; }

  .val-big { font-size: 1.4rem; font-weight: 800; color: var(--text); }
  .val-unit { font-size: 0.9rem; color: var(--gray); margin-left: 2px; }

  /* Modules */
  .info-box { background: #E1F5FE; border-left: 4px solid #0288D1; padding: 12px; border-radius: 8px; margin-top: 15px; }
  
  /* Tooth SVG (Improved) */
  .tooth-svg { max-width: 300px; margin: 0 auto; display: block; }
  .tooth { fill: #F2F2F7; stroke: #C7C7CC; stroke-width: 1.5; transition: 0.3s; }
  .tooth.active { fill: #FFD60A; stroke: #FF9500; }
  
  .warn { background: #FFF3E0; color: #E65100; padding: 10px; border-radius: 8px; font-size: 0.85rem; margin-top: 15px; }
  
  /* List Styles */
  .item-list { padding: 10px; border-bottom: 1px solid #eee; display: flex; gap: 8px; font-size: 0.95rem; }
  .vac-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #eee; font-size: 0.9rem; }
</style>
</head>
<body>

<div class="header">
  <a href="https://www.facebook.com/profile.php?id=61584059466555" target="_blank">
    <span>ğŸ‘ ä¸‹ç­å¾Œçš„æŸå®…ç¾Š</span> <span class="fb-tag">FB</span>
  </a>
</div>

<div class="nav-wrapper">
  <div class="nav">
    <button class="nav-btn active" onclick="app.tab('growth')">ç”Ÿé•·</button>
    <button class="nav-btn" onclick="app.tab('milestone')">ç™¼å±•</button>
    <button class="nav-btn" onclick="app.tab('vaccine')">ç–«è‹—</button>
    <button class="nav-btn" onclick="app.tab('teething')">é•·ç‰™</button>
    <button class="nav-btn" onclick="app.tab('target')">é æ¸¬</button>
  </div>
</div>

<div class="container">

  <div id="view-growth" class="view active">
    <div class="card">
      <div class="radio-grp">
        <div id="rb-boy" class="radio-btn sel-boy" onclick="app.setGender('boy')">ğŸ‘¦ ç”·ç”Ÿ</div>
        <div id="rb-girl" class="radio-btn" onclick="app.setGender('girl')">ğŸ‘§ å¥³ç”Ÿ</div>
      </div>

      <span class="label">å‡ºç”Ÿå¹´æœˆæ—¥</span>
      <div class="date-box">
        <div class="date-row"><span class="sub-lbl">è¥¿å…ƒ</span><input type="date" id="dob-ad" oninput="app.syncDate('ad')"></div>
        <div class="date-row">
            <span class="sub-lbl">æ°‘åœ‹</span><input type="tel" id="roc-y" placeholder="113" style="flex:1" onchange="app.syncDate('roc')"> 
            <span class="sub-lbl">å¹´</span><input type="tel" id="roc-m" placeholder="5" style="width:50px" onchange="app.syncDate('roc')"> 
            <span class="sub-lbl">æœˆ</span><input type="tel" id="roc-d" placeholder="20" style="width:50px" onchange="app.syncDate('roc')"> 
            <span class="sub-lbl">æ—¥</span>
        </div>
      </div>
      
      <div class="row">
         <div style="flex:1"><span class="label">èº«é«˜ (cm)</span><input type="number" id="ht" placeholder="100"></div>
         <div style="flex:1"><span class="label">é«”é‡ (kg)</span><input type="number" id="wt" placeholder="15"></div>
      </div>

      <button class="btn btn-primary" onclick="app.calc()">é–‹å§‹åˆ†æ</button>

      <div id="result-panel" style="display:none; margin-top:20px; border-top:1px solid #eee; padding-top:20px;">
        <div style="font-size:1.3rem; font-weight:800; margin-bottom:5px;" id="age-txt"></div>
        <div style="font-size:0.85rem; color:#888; margin-bottom:20px;">å°ç…§æ¨™æº–: WHO & å°ç£å¸¸ç”¨ç”Ÿé•·æ›²ç·š</div>

        <div class="bar-box">
          <div style="display:flex; justify-content:space-between; align-items:baseline;">
            <span class="label">èº«é«˜</span> <div><span class="val-big" id="h-val"></span><span class="val-unit">cm</span></div>
          </div>
          <div class="bar-container"><div id="h-marker" class="marker"></div></div>
          <div class="bar-legend">
              <span>3% <br><b id="h-p3"></b></span>
              <span>50% <br><b id="h-p50"></b></span>
              <span>97% <br><b id="h-p97"></b></span>
          </div>
        </div>

        <div class="bar-box">
          <div style="display:flex; justify-content:space-between; align-items:baseline;">
            <span class="label">é«”é‡</span> <div><span class="val-big" id="w-val"></span><span class="val-unit">kg</span></div>
          </div>
          <div class="bar-container"><div id="w-marker" class="marker"></div></div>
          <div class="bar-legend">
              <span>3% <br><b id="w-p3"></b></span>
              <span>50% <br><b id="w-p50"></b></span>
              <span>97% <br><b id="w-p97"></b></span>
          </div>
        </div>

        <div class="row" style="align-items:center; justify-content:space-between; border-top:1px dashed #eee; padding-top:10px;">
           <span class="label">BMI</span>
           <div><span class="val-big" id="bmi-val"></span> <span id="bmi-tag" style="font-size:0.8rem; padding:2px 6px; border-radius:4px; color:white; font-weight:bold; display:none;"></span></div>
        </div>

        <div class="info-box">
           <div style="font-weight:bold; color:#0277BD; margin-bottom:5px;">ğŸ’§ å»ºè­°æ¯æ—¥æ°´åˆ†</div>
           <span class="val-big" style="color:#01579B" id="water-val">0</span> ml
           <div style="font-size:0.8rem; opacity:0.7; margin-top:5px;">(å«å¥¶ã€æ¹¯å“ | Holliday-Segar)</div>
        </div>

        <button class="btn btn-outline" onclick="app.copy()">ğŸ“‹ è¤‡è£½ç—…æ­·æ‘˜è¦</button>
      </div>
    </div>
  </div>

  <div id="view-milestone" class="view">
    <div class="card">
      <span class="label">ç™¼å±•è­¦è¨Š (Red Flags)</span>
      <select id="ms-sel" onchange="app.renderMS()" style="margin-bottom:15px;">
        <option value="4m">4å€‹æœˆ</option><option value="6m">6å€‹æœˆ</option><option value="9m">9å€‹æœˆ</option>
        <option value="1y">1æ­²</option><option value="1.5y">1æ­²åŠ</option><option value="2y">2æ­²</option>
        <option value="3y">3æ­²</option><option value="4y">4æ­²</option><option value="5y">5æ­²</option>
      </select>
      <div id="ms-list"></div>
      <div class="warn">è‹¥æœ‰é …ç›®å‹¾é¸ã€Œå¦ã€ï¼Œå»ºè­°å°‹æ±‚å…’ç§‘é†«å¸«è©•ä¼°ã€‚</div>
    </div>
  </div>

  <div id="view-vaccine" class="view">
    <div class="card">
      <div id="vac-age" style="text-align:center; font-weight:bold; color:var(--primary); margin-bottom:15px;"></div>
      <div id="vac-list"></div>
      <div class="warn">ä¾æ“šå°ç£ CDC å¸¸è¦ç–«è‹—æ™‚ç¨‹è©¦ç®—ã€‚</div>
    </div>
  </div>

  <div id="view-teething" class="view">
    <div class="card" style="text-align:center;">
      <div class="row">
        <button class="btn" style="flex:1; padding:10px; font-size:0.9rem;" onclick="app.setToothMode('baby')">ğŸ‘¶ ä¹³ç‰™</button>
        <button class="btn" style="flex:1; padding:10px; font-size:0.9rem; background:#eee; color:#666;" onclick="app.setToothMode('perm')">ğŸ§‘ æ†ç‰™</button>
      </div>
      <div id="tooth-txt" style="font-weight:bold; margin-bottom:10px; color:#00695C;"></div>
      
      <svg class="tooth-svg" viewBox="0 0 220 220">
        <circle id="tu-1r" cx="95" cy="30" r="9" class="tooth" /> 
        <circle id="tu-1l" cx="125" cy="30" r="9" class="tooth" />
        <circle id="tu-2r" cx="75" cy="35" r="8" class="tooth" />
        <circle id="tu-2l" cx="145" cy="35" r="8" class="tooth" />
        <circle id="tu-3r" cx="55" cy="45" r="8" class="tooth" />
        <circle id="tu-3l" cx="165" cy="45" r="8" class="tooth" />
        <circle id="tu-4r" cx="35" cy="60" r="9" class="tooth" />
        <circle id="tu-4l" cx="185" cy="60" r="9" class="tooth" />
        <circle id="tu-5r" cx="20" cy="80" r="10" class="tooth" />
        <circle id="tu-5l" cx="200" cy="80" r="10" class="tooth" />
        
        <circle id="tl-1r" cx="95" cy="190" r="9" class="tooth" />
        <circle id="tl-1l" cx="125" cy="190" r="9" class="tooth" />
        <circle id="tl-2r" cx="75" cy="185" r="8" class="tooth" />
        <circle id="tl-2l" cx="145" cy="185" r="8" class="tooth" />
        <circle id="tl-3r" cx="55" cy="175" r="8" class="tooth" />
        <circle id="tl-3l" cx="165" cy="175" r="8" class="tooth" />
        <circle id="tl-4r" cx="35" cy="160" r="9" class="tooth" />
        <circle id="tl-4l" cx="185" cy="160" r="9" class="tooth" />
        <circle id="tl-5r" cx="20" cy="140" r="10" class="tooth" />
        <circle id="tl-5l" cx="200" cy="140" r="10" class="tooth" />

        <text x="110" y="115" font-size="10" text-anchor="middle" fill="#ccc">å£è…”ç¤ºæ„åœ– (é»ƒè‰²ç‚ºå·²é•·å‡º)</text>
      </svg>
    </div>
  </div>

  <div id="view-target" class="view">
    <div class="card">
      <span class="label">çˆ¶æ¯èº«é«˜ (cm)</span>
      <div class="row">
        <input type="number" id="fh" placeholder="çˆ¶ 175">
        <input type="number" id="mh" placeholder="æ¯ 160">
      </div>
      <button class="btn btn-primary" onclick="app.calcTarget()">è¨ˆç®—</button>
      <div id="target-res" style="text-align:center; margin-top:20px; display:none;">
        <span class="label">é æ¸¬èº«é«˜</span>
        <div style="font-size:2.5rem; font-weight:800; color:var(--primary);"><span id="t-val"></span> <span style="font-size:1rem;">cm</span></div>
        <div style="background:#E3F2FD; color:#007AFF; padding:5px 15px; border-radius:15px; display:inline-block; font-weight:bold; margin-top:5px;">
           å€é–“: <span id="t-range"></span>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
// --- STABLE DATA ENGINE ---
const DB = {
  ms: {
    "4m":["ä¿¯è‡¥æŠ¬é ­45åº¦","é ­éƒ¨ç©©å®š","æ³¨è¦–äººè‡‰","æ‰‹æŒå¼µé–‹"], "6m":["æ‰¶å","ç¿»èº«","ç„¡é¬¥é›çœ¼","ä¸»å‹•æŠ“æ¡"], "9m":["åç©©","çˆ¬è¡Œ","æ›æ‰‹æ‹¿ç‰©","å«ååæ‡‰"], "1y":["æ‰¶ç«™","æŒ‡å°–æŠ“æ¡","ç™¼ã„…ã„‡éŸ³","æ€•ç”Ÿ"], "1.5y":["ç¨èµ°","å«çˆ¸åª½","æŒ‡èªç‰©å“","è½æ‡‚æŒ‡ä»¤"], "2y":["èµ°ç©©","èªªå–®å­—","æ¨¡ä»¿å‹•ä½œ","ç–Šç©æœ¨"], "3y":["é›™è…³è·³","èªªè©±æ¸…æ¥š","èªªåå­—","ç•«åœ“"], "4y":["å–®è…³ç«™","èªªå¥å­","ç©¿è„«è¡£","è¾¨è‰²"], "5y":["å–®è…³è·³","ç•«åå­—","å£é½’æ¸…","ç¤¾äº¤äº’å‹•"]
  },
  growth: {
    boy: [[0,46,50,54,2.5,3.3,4.4],[3,57,61,66,5.0,6.4,8.0],[6,63,68,72,6.4,7.9,9.8],[12,71,76,81,7.7,9.6,12.0],[24,81,88,93,9.7,12.2,15.3],[36,89,96,104,11.3,14.3,18.3],[48,95,103,112,12.7,16.3,21.2],[60,101,110,119,14.1,18.3,24.2],[72,106,117,127,15.9,20.5,27.5],[96,119,128,137,19.5,25.4,35.5],[120,129,138,149,23.7,31.2,45.6],[144,140,150,163,29.1,39.2,59.0],[168,152,163,176,37.2,50.1,75.6],[192,162,173,184,46.3,59.7,86.5],[216,166,176,188,52.0,64.6,91.5]],
    girl: [[0,45,49,53,2.4,3.2,4.2],[3,56,60,64,4.5,5.8,7.5],[6,61,66,70,5.7,7.3,9.3],[12,69,74,79,7.0,8.9,11.5],[24,79,86,93,9.0,11.5,14.8],[36,87,95,103,10.8,13.9,18.1],[48,94,103,111,12.3,16.1,21.5],[60,100,109,119,13.7,18.2,24.9],[72,106,116,127,15.5,20.4,27.9],[96,118,127,136,19.2,25.0,35.5],[120,129,139,150,24.1,32.5,48.5],[144,141,152,164,31.4,42.0,63.5],[168,149,159,171,39.3,50.6,73.5],[192,152,163,174,43.9,55.2,78.5],[216,153,163,175,45.5,56.9,81.0]]
  },
  vaccines: [
    {m:0,n:"Bè‚(1)"},{m:1,n:"Bè‚(2)"},{m:2,n:"äº”åˆä¸€(1)+13åƒ¹(1)"},{m:4,n:"äº”åˆä¸€(2)+13åƒ¹(2)"},
    {m:5,n:"å¡ä»‹è‹—"},{m:6,n:"äº”åˆä¸€(3)+Bè‚(3)"},{m:12,n:"MMR(1)+æ°´ç—˜(1)+13åƒ¹(3)"},{m:15,n:"Aè‚(1)"},
    {m:18,n:"äº”åˆä¸€(4)+Aè‚(2)"},{m:27,n:"æ—¥è…¦(1)+(2)"},{m:60,n:"MMR(2)+å››åˆä¸€+æ°´ç—˜(2)è‡ªè²»"}
  ]
};

const app = {
  data: { gender:'boy', birth:null, copy:'' },
  
  init: function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('dob-ad').max = today;
  },

  tab: function(id) {
    document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
    document.getElementById('view-'+id).classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
    event.target.classList.add('active');
    
    if(id === 'milestone') this.checkMilestone();
    if(id === 'vaccine') this.checkVaccine();
    if(id === 'teething') this.setToothMode('baby');
  },

  setGender: function(g) {
    this.data.gender = g;
    document.getElementById('rb-boy').className = g==='boy'?'radio-btn sel-boy':'radio-btn';
    document.getElementById('rb-girl').className = g==='girl'?'radio-btn sel-girl':'radio-btn';
  },

  syncDate: function(source) {
    const adEl = document.getElementById('dob-ad');
    const yEl = document.getElementById('roc-y');
    const mEl = document.getElementById('roc-m');
    const dEl = document.getElementById('roc-d');

    if (source === 'ad') {
        if(!adEl.value) return;
        const d = new Date(adEl.value);
        yEl.value = d.getFullYear() - 1911; mEl.value = d.getMonth() + 1; dEl.value = d.getDate();
        this.data.birth = d;
    } else {
        const y = parseInt(yEl.value); const m = parseInt(mEl.value); const d = parseInt(dEl.value);
        if (y && m && d && y>0 && m>0 && d>0) {
            const adY = y + 1911;
            const adM = m.toString().padStart(2, '0');
            const adD = d.toString().padStart(2, '0');
            adEl.value = `${adY}-${adM}-${adD}`;
            this.data.birth = new Date(adEl.value);
        }
    }
  },

  calc: function() {
    if(!this.data.birth) { alert("è«‹è¼¸å…¥ç”Ÿæ—¥"); return; }
    const h = parseFloat(document.getElementById('ht').value);
    const w = parseFloat(document.getElementById('wt').value);
    if(!h || !w) { alert("è«‹è¼¸å…¥èº«é«˜é«”é‡"); return; }

    const now = new Date();
    let m = (now.getFullYear() - this.data.birth.getFullYear()) * 12 + (now.getMonth() - this.data.birth.getMonth());
    if(now.getDate() < this.data.birth.getDate()) m--;
    if(m < 0) m = 0;
    
    document.getElementById('age-txt').textContent = `å¹´é½¡ï¼š${Math.floor(m/12)}æ­² ${m%12}å€‹æœˆ`;

    // Growth Interpolation
    const table = DB.growth[this.data.gender];
    let lower = table[0], upper = table[table.length-1];
    for(let i=0; i<table.length-1; i++) {
        if(m >= table[i][0] && m <= table[i+1][0]) { lower = table[i]; upper = table[i+1]; break; }
    }
    const r = (m - lower[0]) / (upper[0] - lower[0] || 1);
    const getVal = (i) => (lower[i] + (upper[i] - lower[i]) * r).toFixed(1);
    
    const ref = { h3:getVal(1), h50:getVal(2), h97:getVal(3), w3:getVal(4), w50:getVal(5), w97:getVal(6) };

    this.updateBar('h', h, ref.h3, ref.h50, ref.h97);
    this.updateBar('w', w, ref.w3, ref.w50, ref.w97);

    // BMI
    const bmi = (w / ((h/100)**2)).toFixed(1);
    document.getElementById('bmi-val').textContent = bmi;
    const bmiTag = document.getElementById('bmi-tag');
    if(m >= 84) { 
       bmiTag.style.display = 'inline-block';
       if(bmi>24) {bmiTag.textContent="éé‡";bmiTag.style.background="#FF3B30";}
       else if(bmi<14) {bmiTag.textContent="éè¼•";bmiTag.style.background="#FF9500";}
       else {bmiTag.textContent="é©ä¸­";bmiTag.style.background="#34C759";}
    } else bmiTag.style.display = 'none';

    // Water
    let water = (w<=10)? w*100 : (w<=20)? 1000+(w-10)*50 : 1500+(w-20)*20;
    document.getElementById('water-val').textContent = Math.round(water);

    document.getElementById('result-panel').style.display = 'block';
    
    this.data.copy = `Growth: ${Math.floor(m/12)}y${m%12}m ${this.data.gender}\nHt: ${h}cm (${ref.h50})\nWt: ${w}kg (${ref.w50})\nBMI: ${bmi}`;
  },

  updateBar: function(type, val, p3, p50, p97) {
    document.getElementById(`${type}-val`).textContent = val;
    document.getElementById(`${type}-p3`).textContent = p3+"cm";
    document.getElementById(`${type}-p50`).textContent = p50+"cm";
    document.getElementById(`${type}-p97`).textContent = p97+"cm";
    if(type==='w') {
        document.getElementById(`${type}-p3`).textContent = p3+"kg";
        document.getElementById(`${type}-p50`).textContent = p50+"kg";
        document.getElementById(`${type}-p97`).textContent = p97+"kg";
    }
    
    let pos = 50;
    if(val < p3) pos = 10;
    else if(val > p97) pos = 90;
    else if(val < p50) pos = 15 + (35 * ((val-p3)/(p50-p3)));
    else pos = 50 + (35 * ((val-p50)/(p97-p50)));
    document.getElementById(`${type}-marker`).style.left = pos + "%";
  },

  checkMilestone: function() {
    if(!this.data.birth) return;
    const now = new Date();
    let m = (now.getFullYear() - this.data.birth.getFullYear()) * 12 + (now.getMonth() - this.data.birth.getMonth());
    const opts = ["4m","6m","9m","1y","1.5y","2y","3y","4y","5y"];
    const vals = [5,7,10,15,20,30,42,54,999];
    let pick = "5y";
    for(let i=0; i<vals.length; i++) { if(m <= vals[i]) { pick = opts[i]; break; } }
    document.getElementById('ms-sel').value = pick;
    this.renderMS();
  },
  renderMS: function() {
    const k = document.getElementById('ms-sel').value;
    let html = "";
    DB.ms[k].forEach(t => html += `<div class="item-list"><span class="check-box">â˜</span> ${t}</div>`);
    document.getElementById('ms-list').innerHTML = html;
  },

  checkVaccine: function() {
    if(!this.data.birth) { document.getElementById('vac-list').innerHTML="è«‹å…ˆè¼¸å…¥ç”Ÿæ—¥"; return; }
    const now = new Date();
    let m = (now.getFullYear() - this.data.birth.getFullYear()) * 12 + (now.getMonth() - this.data.birth.getMonth());
    document.getElementById('vac-age').textContent = `ç›®å‰æœˆé½¡ï¼š${m} å€‹æœˆ`;
    
    let html = "";
    DB.vaccines.forEach(v => {
       const d = new Date(this.data.birth); d.setMonth(d.getMonth() + v.m);
       const dStr = `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`;
       const isPast = now > d;
       const color = isPast ? "#34C759" : "#8E8E93";
       const icon = isPast ? "âœ…" : "ğŸ—“ï¸";
       html += `<div class="vac-row"><div>${v.n}</div><div style="color:${color};">${icon} ${dStr}</div></div>`;
    });
    document.getElementById('vac-list').innerHTML = html;
  },

  setToothMode: function(mode) {
    const now = new Date();
    let m = (now.getFullYear() - this.data.birth.getFullYear()) * 12 + (now.getMonth() - this.data.birth.getMonth());
    const y = Math.floor(m/12);
    document.querySelectorAll('.tooth').forEach(el => el.classList.remove('active'));
    
    let txt = "";
    if(mode === 'baby') {
        if(m>=6) this.light(['tl-1l','tl-1r']);
        if(m>=8) this.light(['tu-1l','tu-1r']);
        if(m>=9) this.light(['tu-2l','tu-2r']);
        if(m>=10) this.light(['tl-2l','tl-2r']);
        if(m>=13) this.light(['tu-4l','tu-4r','tl-4l','tl-4r']);
        if(m>=16) this.light(['tu-3l','tu-3r','tl-3l','tl-3r']);
        if(m>=23) this.light(['tu-5l','tu-5r','tl-5l','tl-5r']);
        txt = "ä¹³ç‰™ (é»ƒè‰²ç‚ºå·²é•·å‡º)";
    } else {
        if(y>=6) this.light(['tu-4l','tu-4r','tl-4l','tl-4r','tl-1l','tl-1r']); // First molar + lower incisor
        if(y>=7) this.light(['tu-1l','tu-1r','tl-2l','tl-2r']); 
        if(y>=8) this.light(['tu-2l','tu-2r']);
        if(y>=9) this.light(['tl-3l','tl-3r']);
        if(y>=10) this.light(['tu-4l','tu-4r','tl-4l','tl-4r']); // Premolars repl. molars
        if(y>=11) this.light(['tu-3l','tu-3r','tu-5l','tu-5r','tl-5l','tl-5r']); 
        if(y>=12) this.light(['tu-5l','tu-5r','tl-5l','tl-5r']); // Second molars
        txt = "æ†ç‰™ (é»ƒè‰²ç‚ºæ›ç‰™/èŒç™¼)";
    }
    document.getElementById('tooth-txt').textContent = txt;
  },
  light: function(ids) { ids.forEach(id => document.getElementById(id)?.classList.add('active')); },

  calcTarget: function() {
    const f = parseFloat(document.getElementById('fh').value);
    const m = parseFloat(document.getElementById('mh').value);
    if(!f || !m) return;
    let t = (this.data.gender === 'boy') ? (f+m+13)/2 : (f+m-13)/2;
    document.getElementById('t-val').textContent = t.toFixed(1);
    document.getElementById('t-range').textContent = `${(t-7.5).toFixed(1)} ~ ${(t+7.5).toFixed(1)}`;
    document.getElementById('target-res').style.display = 'block';
  },

  copy: function() {
     navigator.clipboard.writeText(this.data.copy).then(()=>alert("å·²è¤‡è£½"));
  }
};

document.addEventListener('DOMContentLoaded', ()=>app.init());
</script>
</body>
</html>
